# Use an official Python runtime as a parent image
FROM python:3.12.2-alpine

WORKDIR /app

# Install build deps + curl
RUN apk add --no-cache gcc python3-dev musl-dev linux-headers curl

# Install uv
RUN curl -LsSf https://astral.sh/uv/install.sh | sh -s -- --install-dir /usr/local/bin --exe-name uv

# Copy metadata first, so dependency layer is cacheable
COPY pyproject.toml uv.lock ./

# Install all deps (including dev, if you want)
RUN uv sync --frozen

# Copy source code
COPY . /app

# Create a non-root user and switch to it
RUN adduser -D myuser
USER myuser

EXPOSE 5000

ENV FLASK_APP=app.py \
    LOG_DIRECTORY=/app/logs/

# Run Flask dev server via uv
CMD ["uv", "run", "flask", "run", "--host=0.0.0.0"]

